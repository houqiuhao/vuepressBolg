---
title: 令人头秃的promise
date: 2022-02-16 21:48:54
permalink: /pages/a7c3cf/
categories:
  - 基础知识
  - js
tags:
  - 
---
> **话不多说 先上头**
```js
//猜猜它的输出？
Promise.resolve().then(() => {
    console.log(0);
    return Promise.resolve(4);
}).then((res) => {
    console.log(res)
})

Promise.resolve().then(() => {
    console.log(1);
}).then(() => {
    console.log(2);
}).then(() => {
    console.log(3);
}).then(() => {
    console.log(5);
}).then(() =>{
    console.log(6);
})
// 这他娘的输出是 0 1 2 3 4 5 6 
// 不应该是 0 1 4 2 3……吗？？？
// 一个回答：Js引擎为了让microtask尽快的输出，做了一些优化，连续的多个then(3个)如果没有reject或者resolve会交替执行then而不至于让一个堵太久完成用户无响应，不单单v8这样其他引擎也是这样，因为其实promuse内部状态已经结束了
```

## 宏任务和微任务
js有两种任务的执行模式：同步和异步


## 手写promise

```js
const FULFILLED = 'fulfilled'
const PENDING = 'pending'
const REJECTED = 'rejected'
class MyPromise {

}
```