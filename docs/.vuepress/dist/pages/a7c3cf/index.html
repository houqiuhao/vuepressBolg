<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä»¤äººå¤´ç§ƒçš„promise | Hammer&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="æ„¿çŸ¥æ™“å¹¶ç¬ƒè¡Œ">
    
    <link rel="preload" href="vuepressBlog/assets/css/0.styles.6a0aa8ba.css" as="style"><link rel="preload" href="vuepressBlog/assets/js/app.b09c7bde.js" as="script"><link rel="preload" href="vuepressBlog/assets/js/2.5a10749f.js" as="script"><link rel="preload" href="vuepressBlog/assets/js/21.9b00031d.js" as="script"><link rel="prefetch" href="vuepressBlog/assets/js/10.9b46c8ef.js"><link rel="prefetch" href="vuepressBlog/assets/js/11.b833869a.js"><link rel="prefetch" href="vuepressBlog/assets/js/12.0152770a.js"><link rel="prefetch" href="vuepressBlog/assets/js/13.6ff4abd7.js"><link rel="prefetch" href="vuepressBlog/assets/js/14.fba716d3.js"><link rel="prefetch" href="vuepressBlog/assets/js/15.68d5158c.js"><link rel="prefetch" href="vuepressBlog/assets/js/16.e134af96.js"><link rel="prefetch" href="vuepressBlog/assets/js/17.49685408.js"><link rel="prefetch" href="vuepressBlog/assets/js/18.6f0e1815.js"><link rel="prefetch" href="vuepressBlog/assets/js/19.a95129a5.js"><link rel="prefetch" href="vuepressBlog/assets/js/20.9a04c25b.js"><link rel="prefetch" href="vuepressBlog/assets/js/22.40661e81.js"><link rel="prefetch" href="vuepressBlog/assets/js/23.9b962866.js"><link rel="prefetch" href="vuepressBlog/assets/js/24.172b152a.js"><link rel="prefetch" href="vuepressBlog/assets/js/25.327245f1.js"><link rel="prefetch" href="vuepressBlog/assets/js/26.57757d64.js"><link rel="prefetch" href="vuepressBlog/assets/js/27.0f47433f.js"><link rel="prefetch" href="vuepressBlog/assets/js/28.819e2d66.js"><link rel="prefetch" href="vuepressBlog/assets/js/29.4cbc49d4.js"><link rel="prefetch" href="vuepressBlog/assets/js/3.0903654e.js"><link rel="prefetch" href="vuepressBlog/assets/js/30.aef3d8e1.js"><link rel="prefetch" href="vuepressBlog/assets/js/31.39485533.js"><link rel="prefetch" href="vuepressBlog/assets/js/32.f4fb5633.js"><link rel="prefetch" href="vuepressBlog/assets/js/33.a4a720a6.js"><link rel="prefetch" href="vuepressBlog/assets/js/34.c71f84e9.js"><link rel="prefetch" href="vuepressBlog/assets/js/35.0a2c8c8c.js"><link rel="prefetch" href="vuepressBlog/assets/js/36.b5d4c711.js"><link rel="prefetch" href="vuepressBlog/assets/js/37.d9de29af.js"><link rel="prefetch" href="vuepressBlog/assets/js/38.c05c865b.js"><link rel="prefetch" href="vuepressBlog/assets/js/39.6ef036b0.js"><link rel="prefetch" href="vuepressBlog/assets/js/4.f9ac91a5.js"><link rel="prefetch" href="vuepressBlog/assets/js/40.3666468d.js"><link rel="prefetch" href="vuepressBlog/assets/js/41.74646711.js"><link rel="prefetch" href="vuepressBlog/assets/js/42.be3c717c.js"><link rel="prefetch" href="vuepressBlog/assets/js/43.84d0eb0d.js"><link rel="prefetch" href="vuepressBlog/assets/js/44.843e5645.js"><link rel="prefetch" href="vuepressBlog/assets/js/45.905a4144.js"><link rel="prefetch" href="vuepressBlog/assets/js/46.1a4d6d51.js"><link rel="prefetch" href="vuepressBlog/assets/js/47.06ed11a0.js"><link rel="prefetch" href="vuepressBlog/assets/js/48.c56a8bac.js"><link rel="prefetch" href="vuepressBlog/assets/js/49.a8c1de10.js"><link rel="prefetch" href="vuepressBlog/assets/js/5.a6b83590.js"><link rel="prefetch" href="vuepressBlog/assets/js/50.fdd12d3f.js"><link rel="prefetch" href="vuepressBlog/assets/js/51.c2ac50e3.js"><link rel="prefetch" href="vuepressBlog/assets/js/6.8f08072f.js"><link rel="prefetch" href="vuepressBlog/assets/js/7.3f779175.js"><link rel="prefetch" href="vuepressBlog/assets/js/8.5fab5f0e.js"><link rel="prefetch" href="vuepressBlog/assets/js/9.79239adf.js">
    <link rel="stylesheet" href="vuepressBlog/assets/css/0.styles.6a0aa8ba.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressBlog/" class="home-link router-link-active"><!----> <span class="site-name">Hammer's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åŸºç¡€çŸ¥è¯†" class="dropdown-title"><a href="/vuepressBlog/web/" class="link-title">åŸºç¡€çŸ¥è¯†</a> <span class="title" style="display:none;">åŸºç¡€çŸ¥è¯†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/6dc399/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/9e181c/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/821039/" class="nav-link">js</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/4fffe6/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æŠ€æœ¯" class="dropdown-title"><a href="/vuepressBlog/technology" class="link-title">æŠ€æœ¯</a> <span class="title" style="display:none;">æŠ€æœ¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/6ef1db/" class="nav-link">essays</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/612268/" class="nav-link">PWA</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/37822d/" class="nav-link">use Tool</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/interviewSummary.html" class="nav-link">æ‚è°ˆæ€»ç»“</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/head.jpg"> <div class="blogger-info"><h3>Hammer</h3> <span>æ„¿çŸ¥æ™“å¹¶ç¬ƒè¡Œ</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åŸºç¡€çŸ¥è¯†" class="dropdown-title"><a href="/vuepressBlog/web/" class="link-title">åŸºç¡€çŸ¥è¯†</a> <span class="title" style="display:none;">åŸºç¡€çŸ¥è¯†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/6dc399/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/9e181c/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/821039/" class="nav-link">js</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/4fffe6/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æŠ€æœ¯" class="dropdown-title"><a href="/vuepressBlog/technology" class="link-title">æŠ€æœ¯</a> <span class="title" style="display:none;">æŠ€æœ¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/6ef1db/" class="nav-link">essays</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/612268/" class="nav-link">PWA</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/pages/37822d/" class="nav-link">use Tool</a></li></ul></div></div><div class="nav-item"><a href="/vuepressBlog/interviewSummary.html" class="nav-link">æ‚è°ˆæ€»ç»“</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ä»¤äººå¤´ç§ƒçš„promise</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepressBlog/pages/a7c3cf/#ç¼˜èµ·" class="sidebar-link">ç¼˜èµ·</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/pages/a7c3cf/#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡" class="sidebar-link">å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</a></li></ul></li><li><a href="/vuepressBlog/pages/a7c3cf/#æ‰‹æ’•promise" class="sidebar-link">æ‰‹æ’•Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/pages/a7c3cf/#ä¸€ã€æ ¸å¿ƒç®€å•å®ç°" class="sidebar-link">ä¸€ã€æ ¸å¿ƒç®€å•å®ç°</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/pages/a7c3cf/#äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†" class="sidebar-link">äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/pages/a7c3cf/#ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°" class="sidebar-link">ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/pages/a7c3cf/#å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨-äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«promiseæ˜¯å¦è¿”å›è‡ªå·±-å…­ã€é”™è¯¯æ•è·" class="sidebar-link">å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨ &amp;&amp; äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«Promiseæ˜¯å¦è¿”å›è‡ªå·± &amp;&amp; å…­ã€é”™è¯¯æ•è·</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/pages/a7c3cf/#ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†-å¯¹rejected-å’Œpendingæ”¹é€ " class="sidebar-link">ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†ï¼Œå¯¹rejected å’Œpendingæ”¹é€ </a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/pages/a7c3cf/#å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰-ä¹ã€resolve-å’Œ-rejectçš„é™æ€è°ƒç”¨" class="sidebar-link">å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰ &amp;&amp; ä¹ã€resolve å’Œ rejectçš„é™æ€è°ƒç”¨</a></li></ul></li><li><a href="/vuepressBlog/pages/a7c3cf/#promiseæ–¹æ³•" class="sidebar-link">promiseæ–¹æ³•</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/vuepressBlog/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/vuepressBlog/web/#åŸºç¡€çŸ¥è¯†" data-v-0c557b5e>åŸºç¡€çŸ¥è¯†</a></li><li data-v-0c557b5e><a href="/vuepressBlog/web/#js" data-v-0c557b5e>js</a></li></ul> <div class="info" data-v-0c557b5e><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>hammer</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-02-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">ä»¤äººå¤´ç§ƒçš„promise<!----></h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="header-anchor">#</a> ç¼˜èµ·</h2> <blockquote><p><strong>è¯ä¸å¤šè¯´ å…ˆä¸Šå¤´</strong></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//çŒœçŒœå®ƒçš„è¾“å‡ºï¼Ÿ</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™ä»–å¨˜çš„è¾“å‡ºæ˜¯ 0 1 2 3 4 5 6 </span>
<span class="token comment">// ä¸åº”è¯¥æ˜¯ 0 1 4 2 3â€¦â€¦å—ï¼Ÿï¼Ÿï¼Ÿ</span>
<span class="token comment">// ä¸€ä¸ªå›ç­”ï¼šJså¼•æ“ä¸ºäº†è®©microtaskå°½å¿«çš„è¾“å‡ºï¼Œåšäº†ä¸€äº›ä¼˜åŒ–</span>
<span class="token comment">// è¿ç»­çš„å¤šä¸ªthen(3ä¸ª)å¦‚æœæ²¡æœ‰rejectæˆ–è€…resolveä¼šäº¤æ›¿æ‰§è¡Œthenè€Œä¸è‡³äºè®©ä¸€ä¸ªå µå¤ªä¹…å®Œæˆç”¨æˆ·æ— å“åº”</span>
<span class="token comment">// ä¸å•å•v8è¿™æ ·å…¶ä»–å¼•æ“ä¹Ÿæ˜¯è¿™æ ·ï¼Œå› ä¸ºå…¶å®promuseå†…éƒ¨çŠ¶æ€å·²ç»ç»“æŸäº†</span>
</code></pre></div><h3 id="å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡" class="header-anchor">#</a> å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</h3> <p>jsæœ‰ä¸¤ç§ä»»åŠ¡çš„æ‰§è¡Œæ¨¡å¼ï¼š<strong>åŒæ­¥</strong>å’Œ<strong>å¼‚æ­¥</strong><br>
å¼‚æ­¥ä¸­åˆåˆ†ä¸ºä¸¤ç§ï¼Œå¾®ä»»åŠ¡Microtaskï¼ˆå’Œå®ä»»åŠ¡ï¼ˆMacrotaskï¼‰ï¼Œå®ä»»åŠ¡æ˜¯ç”±å®¿ä¸»ï¼ˆæµè§ˆå™¨ï¼ŒNodeï¼‰å‘èµ·çš„ï¼Œè€Œå¾®ä»»åŠ¡æ˜¯ç”±jsè‡ªèº«å‘èµ·;å®ä»»åŠ¡ä¼šåœ¨ä¸‹æ¬¡äº‹ä»¶å¾ªç¯å¼€å§‹çš„æ—¶å€™æ‰§è¡Œï¼Œå¾®ä»»åŠ¡ä¼šåœ¨æ­¤æ¬¡äº‹ä»¶å¾ªç¯ä¸­åŒæ­¥ä»»åŠ¡ç»“æŸåæ‰§è¡Œ</p> <table><thead><tr><th><strong>å®ä»»åŠ¡</strong>(Macrotas)</th> <th><strong>å¾®ä»»åŠ¡</strong>(Microtask)</th></tr></thead> <tbody><tr><td>setTimeout</td> <td>requestAnimationFrameï¼ˆæœ‰äº‰è®®ï¼‰</td></tr> <tr><td>setInterval</td> <td>MutationObserverï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰</td></tr> <tr><td>MessageChannel</td> <td>Promise.[ then/catch/finally ]</td></tr> <tr><td>I/Oï¼Œäº‹ä»¶é˜Ÿåˆ—</td> <td>process.nextTickï¼ˆNodeç¯å¢ƒï¼‰</td></tr> <tr><td>setImmediateï¼ˆNodeç¯å¢ƒï¼‰</td> <td>queueMicrotask</td></tr> <tr><td>scriptï¼ˆæ•´ä½“ä»£ç å—ï¼‰</td> <td></td></tr></tbody></table> <h2 id="æ‰‹æ’•promise"><a href="#æ‰‹æ’•promise" class="header-anchor">#</a> æ‰‹æ’•Promise</h2> <p>æˆ‘ä»¬ä½¿ç”¨çš„ Promise æ˜¯åŸºäº Promise A+ è§„èŒƒå®ç°çš„</p> <div class="cardListContainer"><div class="card-list"><a href="https://promisesaplus.com/" target="_blank" class="card-item row-1" style="background-color:#DFEEE7;--random-color:#DFEEE7;color:#2A3344;"><div><p class="name">Promise A+ è§„èŒƒ</p> <p class="desc">ğŸš€ç‚¹å‡»æŸ¥çœ‹Promise A+ çš„å®˜æ–¹è§„èŒƒ</p></div></a></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Promise A+ è§„èŒƒ
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> ğŸš€ç‚¹å‡»æŸ¥çœ‹Promise A+ çš„å®˜æ–¹è§„èŒƒ
  <span class="token key atrule">link</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//promisesaplus.com/
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">'#DFEEE7'</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">'#2A3344'</span>
</code></pre></div></div><p>flow æ˜é‡‘ <strong>ITè€ç­é•¿</strong>å¤§ä½¬çš„æ–‡ç« å­¦ç€æ‰‹å†™ä¸€ç‰ˆï¼Œ<strong>å¤§ä½¬è¯´é“</strong>ï¼šå¾ˆå¤šæ‰‹å†™ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨ setTimeout å»åšå¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯ setTimeout å±äºå®ä»»åŠ¡ï¼Œè¿™ä¸ Promise æ˜¯ä¸ªå¾®ä»»åŠ¡ç›¸çŸ›ç›¾ï¼Œæ‰€ä»¥æ‰“ç®—é€‰æ‹©ä¸€ç§åˆ›å»ºå¾®ä»»åŠ¡çš„æ–¹å¼å»å®ç°æˆ‘ä»¬çš„æ‰‹å†™ä»£ç ã€‚<br>
è¿™é‡Œæˆ‘ä»¬æœ‰å‡ ç§é€‰æ‹©ï¼Œä¸€ç§å°±æ˜¯ Promise A+ è§„èŒƒä¸­ä¹Ÿæåˆ°çš„ï¼Œprocess.nextTickï¼ˆ Node ç«¯ ï¼‰ ä¸MutationObserverï¼ˆ æµè§ˆå™¨ç«¯ ï¼‰ï¼Œè€ƒè™‘åˆ°åˆ©ç”¨è¿™ä¸¤ç§æ–¹å¼éœ€è¦åšç¯å¢ƒåˆ¤æ–­ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬å°±æ¨èå¦å¤–ä¸€ç§åˆ›å»ºå¾®ä»»åŠ¡çš„æ–¹å¼ queueMicrotask</p> <div class="language- extra-class"><pre><code>åŸºæœ¬åŸç†ï¼š
1. Promise æ˜¯ä¸€ä¸ªç±»ï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªç±»çš„æ—¶å€™ä¼šä¼ å…¥ä¸€ä¸ªæ‰§è¡Œå™¨ï¼Œè¿™ä¸ªæ‰§è¡Œå™¨ä¼šç«‹å³æ‰§è¡Œ
2. Promise ä¼šæœ‰ä¸‰ç§çŠ¶æ€
    Pending ç­‰å¾…
    Fulfilled å®Œæˆ
    Rejected å¤±è´¥
3. çŠ¶æ€åªèƒ½ç”± Pending --&gt; Fulfilled æˆ–è€… Pending --&gt; Rejectedï¼Œä¸”ä¸€ä½†å‘ç”Ÿæ”¹å˜ä¾¿ä¸å¯äºŒæ¬¡ä¿®æ”¹ï¼›
4. Promise ä¸­ä½¿ç”¨ resolve å’Œ reject ä¸¤ä¸ªå‡½æ•°æ¥æ›´æ”¹çŠ¶æ€ï¼›
5. then æ–¹æ³•å†…éƒ¨åšä½†äº‹æƒ…å°±æ˜¯çŠ¶æ€åˆ¤æ–­
    å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸï¼Œè°ƒç”¨æˆåŠŸå›è°ƒå‡½æ•°
    å¦‚æœçŠ¶æ€æ˜¯å¤±è´¥ï¼Œè°ƒç”¨å¤±è´¥å›è°ƒå‡½æ•°
</code></pre></div><h3 id="ä¸€ã€æ ¸å¿ƒç®€å•å®ç°"><a href="#ä¸€ã€æ ¸å¿ƒç®€å•å®ç°" class="header-anchor">#</a> ä¸€ã€æ ¸å¿ƒç®€å•å®ç°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>

    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>

    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
            <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><p>ä¸Šé¢ä»£ç å¯ä»¥å®ç°ç®€å•çš„æ–°å»ºpromiseäº†å¯ä»¥ç”¨å¦‚ä¸‹ä»£ç æµ‹è¯•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
   <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reject'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼šresolve success</span>
</code></pre></div><h3 id="äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†"><a href="#äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†" class="header-anchor">#</a> äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†</h3> <p>ä½†æ˜¯å¦‚æœå¤šæµ‹è¯•ä¸‹å°±å‘ç°è§£å†³ä¸äº†å¼‚æ­¥é—®é¢˜ï¼Œæ‰€ä»¥ç»§ç»­åŠ </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// å¼‚æ­¥æ–°å¢</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token keyword">null</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onFulfilledCallback</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onRejectedCallback</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
            <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback <span class="token operator">=</span> onFulfilled
            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback <span class="token operator">=</span> onFulfilled
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°"><a href="#ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°" class="header-anchor">#</a> ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
            <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨-äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«promiseæ˜¯å¦è¿”å›è‡ªå·±-å…­ã€é”™è¯¯æ•è·"><a href="#å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨-äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«promiseæ˜¯å¦è¿”å›è‡ªå·±-å…­ã€é”™è¯¯æ•è·" class="header-anchor">#</a> å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨ &amp;&amp; äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«Promiseæ˜¯å¦è¿”å›è‡ªå·± &amp;&amp; å…­ã€é”™è¯¯æ•è·</h3> <div class="language- extra-class"><pre><code>then æ–¹æ³•è¦é“¾å¼è°ƒç”¨é‚£ä¹ˆå°±éœ€è¦è¿”å›ä¸€ä¸ª Promise å¯¹è±¡
then æ–¹æ³•é‡Œé¢ return ä¸€ä¸ªè¿”å›å€¼ä½œä¸ºä¸‹ä¸€ä¸ª then æ–¹æ³•çš„å‚æ•°ï¼Œå¦‚æœæ˜¯ return ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ¤æ–­å®ƒçš„çŠ¶æ€
-------------------------------------------------------------------------------
å¦‚æœ then æ–¹æ³•è¿”å›çš„æ˜¯è‡ªå·±çš„ Promise å¯¹è±¡ï¼Œåˆ™ä¼šå‘ç”Ÿå¾ªç¯è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ç¨‹åºä¼šæŠ¥é”™
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token comment">// ===æ–°å¢===</span>
    <span class="token comment">// é“¾å¼è°ƒç”¨å°±å¾—è¿”å›promise åˆ¤æ–­çŠ¶æ€è¿›è¡Œå¤„ç†</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// === æ–°å¢ ===</span>
        <span class="token comment">// å…ˆåˆ›å»ºpromise</span>
        <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
                <span class="token comment">// ä¿å­˜è¿”å›çš„å¤„ç†å€¼</span>

                <span class="token comment">// äº”ã€éœ€è¦åˆ›å»ºå¾®ä»»åŠ¡ç­‰å¾…promise2åˆ›å»ºå®Œæ¯•</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// ï¼ï¼è¦å°†promise2 returnå‡ºæ¥</span>
        <span class="token keyword">return</span> promise2
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// === æ–°å¢ ===</span>
<span class="token comment">// åˆ›å»ºå‡½æ•°å¤„ç†promise</span>
<span class="token keyword">function</span> <span class="token function">resolvePromise</span> <span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ¤æ–­æ˜¯å¦promise</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span>
        <span class="token comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span>
        <span class="token comment">// ç®€åŒ–ä¹‹å</span>
        x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ™®é€šå€¼</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†-å¯¹rejected-å’Œpendingæ”¹é€ "><a href="#ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†-å¯¹rejected-å’Œpendingæ”¹é€ " class="header-anchor">#</a> ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†ï¼Œå¯¹rejected å’Œpendingæ”¹é€ </h3> <div class="language- extra-class"><pre><code>å¢åŠ å¼‚æ­¥çŠ¶æ€ä¸‹çš„é“¾å¼è°ƒç”¨
å¢åŠ å›è°ƒå‡½æ•°æ‰§è¡Œç»“æœçš„åˆ¤æ–­
å¢åŠ è¯†åˆ« Promise æ˜¯å¦è¿”å›è‡ªå·±
å¢åŠ é”™è¯¯æ•è·
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token comment">// ===æ–°å¢===</span>
    <span class="token comment">// é“¾å¼è°ƒç”¨å°±å¾—è¿”å›promise åˆ¤æ–­çŠ¶æ€è¿›è¡Œå¤„ç†</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// === æ–°å¢ ===</span>
        <span class="token comment">// å…ˆåˆ›å»ºpromise</span>
        <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
                <span class="token comment">// ä¿å­˜è¿”å›çš„å¤„ç†å€¼</span>

                <span class="token comment">// äº”ã€éœ€è¦åˆ›å»ºå¾®ä»»åŠ¡ç­‰å¾…promise2åˆ›å»ºå®Œæ¯•</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åŒä¸Šé¢ å¢åŠ å¾®ä»»åŠ¡</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
                <span class="token comment">// === æ–°å¢ ===</span>
                <span class="token comment">// ===éœ€è¦pushè¿›å»çš„åº”è¯¥æ˜¯å¾®ä»»åŠ¡===</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// ï¼ï¼è¦å°†promise2 returnå‡ºæ¥</span>
        <span class="token keyword">return</span> promise2
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆ›å»ºå‡½æ•°å¤„ç†promise</span>
<span class="token keyword">function</span> <span class="token function">resolvePromise</span> <span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ¤æ–­æ˜¯å¦promise</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span>
        <span class="token comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span>
        <span class="token comment">// ç®€åŒ–ä¹‹å</span>
        x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ™®é€šå€¼</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰-ä¹ã€resolve-å’Œ-rejectçš„é™æ€è°ƒç”¨"><a href="#å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰-ä¹ã€resolve-å’Œ-rejectçš„é™æ€è°ƒç”¨" class="header-anchor">#</a> å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰ &amp;&amp; ä¹ã€resolve å’Œ rejectçš„é™æ€è°ƒç”¨</h3> <p>åŸç”Ÿpromise then ä¸ä¼ é€’å›è°ƒå‡½æ•°ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token comment">// ===æ–°å¢===</span>
    <span class="token comment">// é“¾å¼è°ƒç”¨å°±å¾—è¿”å›promise åˆ¤æ–­çŠ¶æ€è¿›è¡Œå¤„ç†</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å…« === æ–°å¢ ===</span>
        onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
        onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> reason<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// å…ˆåˆ›å»ºpromise</span>
        <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
                <span class="token comment">// ä¿å­˜è¿”å›çš„å¤„ç†å€¼</span>

                <span class="token comment">// äº”ã€éœ€è¦åˆ›å»ºå¾®ä»»åŠ¡ç­‰å¾…promise2åˆ›å»ºå®Œæ¯•</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åŒä¸Šé¢ å¢åŠ å¾®ä»»åŠ¡</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
                <span class="token comment">// === æ–°å¢ ===</span>
                <span class="token comment">// ===éœ€è¦pushè¿›å»çš„åº”è¯¥æ˜¯å¾®ä»»åŠ¡===</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// ï¼ï¼è¦å°†promise2 returnå‡ºæ¥</span>
        <span class="token keyword">return</span> promise2
    <span class="token punctuation">}</span>
    <span class="token comment">// ä¹ã€å¢åŠ é™æ€æ–¹æ³•</span>
    <span class="token keyword">static</span> <span class="token function">resolve</span> <span class="token punctuation">(</span><span class="token parameter">parameter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>parameter <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> parameter
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token parameter">resovle</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token function">reject</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆ›å»ºå‡½æ•°å¤„ç†promise</span>
<span class="token keyword">function</span> <span class="token function">resolvePromise</span> <span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// // åˆ¤æ–­æ˜¯å¦promise</span>
    <span class="token comment">// if(x instanceof MyPromise) {</span>
    <span class="token comment">//     // æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span>
    <span class="token comment">//     // x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span>
    <span class="token comment">//     // ç®€åŒ–ä¹‹å</span>
    <span class="token comment">//     x.then(resolve, reject)</span>

    <span class="token comment">// ========è¿™æ³¢å±…ç„¶è¦æ”¹æˆ ===========</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// x ä¸º null ç›´æ¥è¿”å›ï¼Œèµ°åé¢çš„é€»è¾‘ä¼šæŠ¥é”™</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> then<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŠŠ x.then èµ‹å€¼ç»™ then </span>
            then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœå– x.then çš„å€¼æ—¶æŠ›å‡ºé”™è¯¯ error ï¼Œåˆ™ä»¥ error ä¸ºæ®å› æ‹’ç» promise</span>
            <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœ then æ˜¯å‡½æ•°</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> called <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
                x<span class="token punctuation">,</span> <span class="token comment">// this æŒ‡å‘ x</span>
                <span class="token comment">// å¦‚æœ resolvePromise ä»¥å€¼ y ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™è¿è¡Œ [[Resolve]](promise, y)</span>
                <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// å¦‚æœ resolvePromise å’Œ rejectPromise å‡è¢«è°ƒç”¨ï¼Œ</span>
                    <span class="token comment">// æˆ–è€…è¢«åŒä¸€å‚æ•°è°ƒç”¨äº†å¤šæ¬¡ï¼Œåˆ™ä¼˜å…ˆé‡‡ç”¨é¦–æ¬¡è°ƒç”¨å¹¶å¿½ç•¥å‰©ä¸‹çš„è°ƒç”¨</span>
                    <span class="token comment">// å®ç°è¿™æ¡éœ€è¦å‰é¢åŠ ä¸€ä¸ªå˜é‡ called</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                    called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// å¦‚æœ rejectPromise ä»¥æ®å›  r ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™ä»¥æ®å›  r æ‹’ç» promise</span>
                <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                    called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¦‚æœè°ƒç”¨ then æ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ errorï¼š</span>
                <span class="token comment">// å¦‚æœ resolvePromise æˆ– rejectPromise å·²ç»è¢«è°ƒç”¨ï¼Œç›´æ¥è¿”å›</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token comment">// å¦åˆ™ä»¥ error ä¸ºæ®å› æ‹’ç» promise</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœ then ä¸æ˜¯å‡½æ•°ï¼Œä»¥ x ä¸ºå‚æ•°æ‰§è¡Œ promise</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ™®é€šå€¼</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h2 id="promiseæ–¹æ³•"><a href="#promiseæ–¹æ³•" class="header-anchor">#</a> promiseæ–¹æ³•</h2> <blockquote><p>å†ç»åƒè¾›ä¸‡è‹¦ è¿˜æœ‰åƒè¾›ä¸‡è‹¦
å­¦ä¼šäº†æ‰‹å†™promiseå‡½æ•°ï¼Œè¿˜éœ€è¦å†™promise.all(),promise.race()ç­‰ç­‰,åŠ æ²¹å§å°‘å¹´</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2/20/2022, 11:34:00 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/vuepressBlog/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/vuepressBlog/pages/4f48d2/"><div>
            vueå®ç°åŸç†æµ…æ
            <!----></div></a> <span class="date">02-26</span></dt></dl><dl><dd>02</dd> <dt><a href="/vuepressBlog/pages/68489d/"><div>
            vue3çš„ç ´åæ€§å˜æ›´
            <!----></div></a> <span class="date">02-25</span></dt></dl><dl><dd>03</dd> <dt><a href="/vuepressBlog/pages/ce3390/"><div>
            æ•°ç»„æ‰å¹³åŒ–å’ŒæŸ¯é‡ŒåŒ–
            <!----></div></a> <span class="date">02-23</span></dt></dl> <dl><dd></dd> <dt><a href="/vuepressBlog/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2021-2022
    <span></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">Ã—</span> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"></div></div>
    <script src="vuepressBlog/assets/js/app.b09c7bde.js" defer></script><script src="vuepressBlog/assets/js/2.5a10749f.js" defer></script><script src="vuepressBlog/assets/js/21.9b00031d.js" defer></script>
  </body>
</html>
