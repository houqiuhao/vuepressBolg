<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä»¤äººå¤´ç§ƒçš„promise | Hammer&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="æ„¿çŸ¥æ™“å¹¶ç¬ƒè¡Œ">
    
    <link rel="preload" href="/vuepressBolg/assets/css/0.styles.425e1e7c.css" as="style"><link rel="preload" href="/vuepressBolg/assets/js/app.92d159cb.js" as="script"><link rel="preload" href="/vuepressBolg/assets/js/2.c937a76a.js" as="script"><link rel="preload" href="/vuepressBolg/assets/js/3.ed4544f5.js" as="script"><link rel="preload" href="/vuepressBolg/assets/js/23.deca2de3.js" as="script"><link rel="prefetch" href="/vuepressBolg/assets/js/10.a84229bc.js"><link rel="prefetch" href="/vuepressBolg/assets/js/11.fe58f9c0.js"><link rel="prefetch" href="/vuepressBolg/assets/js/12.06fc3c03.js"><link rel="prefetch" href="/vuepressBolg/assets/js/13.3c4a88ed.js"><link rel="prefetch" href="/vuepressBolg/assets/js/14.c961aa60.js"><link rel="prefetch" href="/vuepressBolg/assets/js/15.153107f3.js"><link rel="prefetch" href="/vuepressBolg/assets/js/16.5972ac9e.js"><link rel="prefetch" href="/vuepressBolg/assets/js/17.fae0334d.js"><link rel="prefetch" href="/vuepressBolg/assets/js/18.74a3187c.js"><link rel="prefetch" href="/vuepressBolg/assets/js/19.c2c9393d.js"><link rel="prefetch" href="/vuepressBolg/assets/js/20.1b19ef84.js"><link rel="prefetch" href="/vuepressBolg/assets/js/21.7934b2d6.js"><link rel="prefetch" href="/vuepressBolg/assets/js/22.770e2ec5.js"><link rel="prefetch" href="/vuepressBolg/assets/js/24.1bb3cfe2.js"><link rel="prefetch" href="/vuepressBolg/assets/js/25.57df786d.js"><link rel="prefetch" href="/vuepressBolg/assets/js/26.4a523e6d.js"><link rel="prefetch" href="/vuepressBolg/assets/js/27.c8a2399b.js"><link rel="prefetch" href="/vuepressBolg/assets/js/28.e783fad3.js"><link rel="prefetch" href="/vuepressBolg/assets/js/29.0788591a.js"><link rel="prefetch" href="/vuepressBolg/assets/js/30.004f2ebc.js"><link rel="prefetch" href="/vuepressBolg/assets/js/31.f50f3268.js"><link rel="prefetch" href="/vuepressBolg/assets/js/32.c3b0dd25.js"><link rel="prefetch" href="/vuepressBolg/assets/js/33.5a798468.js"><link rel="prefetch" href="/vuepressBolg/assets/js/34.559445e9.js"><link rel="prefetch" href="/vuepressBolg/assets/js/35.8bc94b7f.js"><link rel="prefetch" href="/vuepressBolg/assets/js/36.64277864.js"><link rel="prefetch" href="/vuepressBolg/assets/js/37.19f739b7.js"><link rel="prefetch" href="/vuepressBolg/assets/js/38.d6dd43eb.js"><link rel="prefetch" href="/vuepressBolg/assets/js/39.82a8f5e7.js"><link rel="prefetch" href="/vuepressBolg/assets/js/4.10677414.js"><link rel="prefetch" href="/vuepressBolg/assets/js/40.09a5a4ca.js"><link rel="prefetch" href="/vuepressBolg/assets/js/41.fcefeaa9.js"><link rel="prefetch" href="/vuepressBolg/assets/js/42.fc568294.js"><link rel="prefetch" href="/vuepressBolg/assets/js/43.65b91f0f.js"><link rel="prefetch" href="/vuepressBolg/assets/js/44.a8c897e4.js"><link rel="prefetch" href="/vuepressBolg/assets/js/45.aeef5391.js"><link rel="prefetch" href="/vuepressBolg/assets/js/46.d4dd3af5.js"><link rel="prefetch" href="/vuepressBolg/assets/js/47.41054d30.js"><link rel="prefetch" href="/vuepressBolg/assets/js/48.2e4218d3.js"><link rel="prefetch" href="/vuepressBolg/assets/js/49.bdda3840.js"><link rel="prefetch" href="/vuepressBolg/assets/js/5.4dc23a5d.js"><link rel="prefetch" href="/vuepressBolg/assets/js/50.432444cf.js"><link rel="prefetch" href="/vuepressBolg/assets/js/51.1989026c.js"><link rel="prefetch" href="/vuepressBolg/assets/js/52.24c1688b.js"><link rel="prefetch" href="/vuepressBolg/assets/js/53.804477cf.js"><link rel="prefetch" href="/vuepressBolg/assets/js/54.db9b7cc3.js"><link rel="prefetch" href="/vuepressBolg/assets/js/55.2d7e56c3.js"><link rel="prefetch" href="/vuepressBolg/assets/js/56.d750c04f.js"><link rel="prefetch" href="/vuepressBolg/assets/js/57.fa49f77a.js"><link rel="prefetch" href="/vuepressBolg/assets/js/58.a76fa23a.js"><link rel="prefetch" href="/vuepressBolg/assets/js/59.2c01050b.js"><link rel="prefetch" href="/vuepressBolg/assets/js/6.ef55640e.js"><link rel="prefetch" href="/vuepressBolg/assets/js/60.8ca458ca.js"><link rel="prefetch" href="/vuepressBolg/assets/js/61.983030d1.js"><link rel="prefetch" href="/vuepressBolg/assets/js/62.9f52cd80.js"><link rel="prefetch" href="/vuepressBolg/assets/js/63.dfe980f3.js"><link rel="prefetch" href="/vuepressBolg/assets/js/64.c4118fe8.js"><link rel="prefetch" href="/vuepressBolg/assets/js/65.5281d38c.js"><link rel="prefetch" href="/vuepressBolg/assets/js/66.c7f9effa.js"><link rel="prefetch" href="/vuepressBolg/assets/js/67.e049d0fb.js"><link rel="prefetch" href="/vuepressBolg/assets/js/68.dffe8e30.js"><link rel="prefetch" href="/vuepressBolg/assets/js/69.2ebfd48d.js"><link rel="prefetch" href="/vuepressBolg/assets/js/7.cc27baa5.js"><link rel="prefetch" href="/vuepressBolg/assets/js/70.2c1faf32.js"><link rel="prefetch" href="/vuepressBolg/assets/js/71.83d0e1ca.js"><link rel="prefetch" href="/vuepressBolg/assets/js/8.331d453d.js"><link rel="prefetch" href="/vuepressBolg/assets/js/9.59e76992.js">
    <link rel="stylesheet" href="/vuepressBolg/assets/css/0.styles.425e1e7c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressBolg/" class="home-link router-link-active"><!----> <span class="site-name">Hammer's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressBolg/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯åŸºç¡€" class="dropdown-title"><a href="/vuepressBolg/web/" class="link-title">å‰ç«¯åŸºç¡€</a> <span class="title" style="display:none;">å‰ç«¯åŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>html</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBolg/pages/6dc399/" class="nav-link">htmlæ€»ç»“</a></li></ul></li><li class="dropdown-item"><h4>css</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBolg/pages/9e181c/" class="nav-link">cssæ€»ç»“</a></li></ul></li><li class="dropdown-item"><h4>js</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBolg/pages/dbab9c/" class="nav-link">jsç»§æ‰¿</a></li><li class="dropdown-subitem"><a href="/vuepressBolg/pages/a7c3cf/" aria-current="page" class="nav-link router-link-exact-active router-link-active">æ‰‹å†™promise</a></li><li class="dropdown-subitem"><a href="/vuepressBolg/pages/fb3995/" class="nav-link">EventEmitter</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="VUE" class="dropdown-title"><a href="/vuepressBolg/technology" class="link-title">VUE</a> <span class="title" style="display:none;">VUE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBolg/pages/4fffe6/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="httpåŠæµè§ˆå™¨" class="dropdown-title"><a href="/vuepressBolg/interviewSummary" class="link-title">httpåŠæµè§ˆå™¨</a> <span class="title" style="display:none;">httpåŠæµè§ˆå™¨</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBolg/pages/869547/" class="nav-link">http</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://s1.ax1x.com/2022/03/08/b2nunA.jpg"> <div class="blogger-info"><h3>Hammer</h3> <span>æ„¿çŸ¥æ™“å¹¶ç¬ƒè¡Œ</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepressBolg/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯åŸºç¡€" class="dropdown-title"><a href="/vuepressBolg/web/" class="link-title">å‰ç«¯åŸºç¡€</a> <span class="title" style="display:none;">å‰ç«¯åŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>html</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBolg/pages/6dc399/" class="nav-link">htmlæ€»ç»“</a></li></ul></li><li class="dropdown-item"><h4>css</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBolg/pages/9e181c/" class="nav-link">cssæ€»ç»“</a></li></ul></li><li class="dropdown-item"><h4>js</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepressBolg/pages/dbab9c/" class="nav-link">jsç»§æ‰¿</a></li><li class="dropdown-subitem"><a href="/vuepressBolg/pages/a7c3cf/" aria-current="page" class="nav-link router-link-exact-active router-link-active">æ‰‹å†™promise</a></li><li class="dropdown-subitem"><a href="/vuepressBolg/pages/fb3995/" class="nav-link">EventEmitter</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="VUE" class="dropdown-title"><a href="/vuepressBolg/technology" class="link-title">VUE</a> <span class="title" style="display:none;">VUE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBolg/pages/4fffe6/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="httpåŠæµè§ˆå™¨" class="dropdown-title"><a href="/vuepressBolg/interviewSummary" class="link-title">httpåŠæµè§ˆå™¨</a> <span class="title" style="display:none;">httpåŠæµè§ˆå™¨</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBolg/pages/869547/" class="nav-link">http</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ä»¤äººå¤´ç§ƒçš„promise</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepressBolg/pages/a7c3cf/#ç¼˜èµ·" class="sidebar-link">ç¼˜èµ·</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepressBolg/pages/a7c3cf/#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡" class="sidebar-link">å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</a></li></ul></li><li><a href="/vuepressBolg/pages/a7c3cf/#æ‰‹æ’•promise" class="sidebar-link">æ‰‹æ’•Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepressBolg/pages/a7c3cf/#ä¸€ã€æ ¸å¿ƒç®€å•å®ç°" class="sidebar-link">ä¸€ã€æ ¸å¿ƒç®€å•å®ç°</a></li><li class="sidebar-sub-header level3"><a href="/vuepressBolg/pages/a7c3cf/#äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†" class="sidebar-link">äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†</a></li><li class="sidebar-sub-header level3"><a href="/vuepressBolg/pages/a7c3cf/#ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°" class="sidebar-link">ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°</a></li><li class="sidebar-sub-header level3"><a href="/vuepressBolg/pages/a7c3cf/#å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨-äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«promiseæ˜¯å¦è¿”å›è‡ªå·±-å…­ã€é”™è¯¯æ•è·" class="sidebar-link">å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨ &amp;&amp; äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«Promiseæ˜¯å¦è¿”å›è‡ªå·± &amp;&amp; å…­ã€é”™è¯¯æ•è·</a></li><li class="sidebar-sub-header level3"><a href="/vuepressBolg/pages/a7c3cf/#ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†-å¯¹rejected-å’Œpendingæ”¹é€ " class="sidebar-link">ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†ï¼Œå¯¹rejected å’Œpendingæ”¹é€ </a></li><li class="sidebar-sub-header level3"><a href="/vuepressBolg/pages/a7c3cf/#å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰-ä¹ã€resolve-å’Œ-rejectçš„é™æ€è°ƒç”¨" class="sidebar-link">å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰ &amp;&amp; ä¹ã€resolve å’Œ rejectçš„é™æ€è°ƒç”¨</a></li></ul></li><li><a href="/vuepressBolg/pages/a7c3cf/#promiseæ–¹æ³•" class="sidebar-link">promiseæ–¹æ³•</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-d5e9d2e6><div class="articleInfo" data-v-d5e9d2e6><ul class="breadcrumbs" data-v-d5e9d2e6><li data-v-d5e9d2e6><a href="/vuepressBolg/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-d5e9d2e6></a></li> <li data-v-d5e9d2e6><a href="/vuepressBolg/web/#å‰ç«¯åŸºç¡€" data-v-d5e9d2e6>å‰ç«¯åŸºç¡€</a></li><li data-v-d5e9d2e6><a href="/vuepressBolg/web/#js" data-v-d5e9d2e6>js</a></li></ul> <div class="info" data-v-d5e9d2e6><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-d5e9d2e6><a href="javascript:;" data-v-d5e9d2e6>hammer</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-d5e9d2e6><a href="javascript:;" data-v-d5e9d2e6>2022-02-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">ä»¤äººå¤´ç§ƒçš„promise<!----></h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="header-anchor">#</a> ç¼˜èµ·</h2> <blockquote><p><strong>è¯ä¸å¤šè¯´ å…ˆä¸Šå¤´</strong></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//çŒœçŒœå®ƒçš„è¾“å‡ºï¼Ÿ</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™ä»–å¨˜çš„è¾“å‡ºæ˜¯ 0 1 2 3 4 5 6 </span>
<span class="token comment">// ä¸åº”è¯¥æ˜¯ 0 1 4 2 3â€¦â€¦å—ï¼Ÿï¼Ÿï¼Ÿ</span>
<span class="token comment">// ä¸€ä¸ªå›ç­”ï¼šJså¼•æ“ä¸ºäº†è®©microtaskå°½å¿«çš„è¾“å‡ºï¼Œåšäº†ä¸€äº›ä¼˜åŒ–</span>
<span class="token comment">// è¿ç»­çš„å¤šä¸ªthen(3ä¸ª)å¦‚æœæ²¡æœ‰rejectæˆ–è€…resolveä¼šäº¤æ›¿æ‰§è¡Œthenè€Œä¸è‡³äºè®©ä¸€ä¸ªå µå¤ªä¹…å®Œæˆç”¨æˆ·æ— å“åº”</span>
<span class="token comment">// ä¸å•å•v8è¿™æ ·å…¶ä»–å¼•æ“ä¹Ÿæ˜¯è¿™æ ·ï¼Œå› ä¸ºå…¶å®promuseå†…éƒ¨çŠ¶æ€å·²ç»ç»“æŸäº†</span>
</code></pre></div><h3 id="å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡" class="header-anchor">#</a> å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</h3> <p>jsæœ‰ä¸¤ç§ä»»åŠ¡çš„æ‰§è¡Œæ¨¡å¼ï¼š<strong>åŒæ­¥</strong>å’Œ<strong>å¼‚æ­¥</strong><br>
å¼‚æ­¥ä¸­åˆåˆ†ä¸ºä¸¤ç§ï¼Œå¾®ä»»åŠ¡Microtaskï¼ˆå’Œå®ä»»åŠ¡ï¼ˆMacrotaskï¼‰ï¼Œå®ä»»åŠ¡æ˜¯ç”±å®¿ä¸»ï¼ˆæµè§ˆå™¨ï¼ŒNodeï¼‰å‘èµ·çš„ï¼Œè€Œå¾®ä»»åŠ¡æ˜¯ç”±jsè‡ªèº«å‘èµ·;å®ä»»åŠ¡ä¼šåœ¨ä¸‹æ¬¡äº‹ä»¶å¾ªç¯å¼€å§‹çš„æ—¶å€™æ‰§è¡Œï¼Œå¾®ä»»åŠ¡ä¼šåœ¨æ­¤æ¬¡äº‹ä»¶å¾ªç¯ä¸­åŒæ­¥ä»»åŠ¡ç»“æŸåæ‰§è¡Œ</p> <table><thead><tr><th><strong>å®ä»»åŠ¡</strong>(Macrotas)</th> <th><strong>å¾®ä»»åŠ¡</strong>(Microtask)</th></tr></thead> <tbody><tr><td>setTimeout</td> <td>requestAnimationFrameï¼ˆæœ‰äº‰è®®ï¼‰</td></tr> <tr><td>setInterval</td> <td>MutationObserverï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰</td></tr> <tr><td>MessageChannel</td> <td>Promise.[ then/catch/finally ]</td></tr> <tr><td>I/Oï¼Œäº‹ä»¶é˜Ÿåˆ—</td> <td>process.nextTickï¼ˆNodeç¯å¢ƒï¼‰</td></tr> <tr><td>setImmediateï¼ˆNodeç¯å¢ƒï¼‰</td> <td>queueMicrotask</td></tr> <tr><td>scriptï¼ˆæ•´ä½“ä»£ç å—ï¼‰</td> <td></td></tr></tbody></table> <h2 id="æ‰‹æ’•promise"><a href="#æ‰‹æ’•promise" class="header-anchor">#</a> æ‰‹æ’•Promise</h2> <p>æˆ‘ä»¬ä½¿ç”¨çš„ Promise æ˜¯åŸºäº Promise A+ è§„èŒƒå®ç°çš„</p> <div class="cardListContainer"><div class="card-list"><a href="https://promisesaplus.com/" target="_blank" class="card-item row-1" style="background-color:#DFEEE7;--random-color:#DFEEE7;color:#2A3344;"><div><p class="name">Promise A+ è§„èŒƒ</p> <p class="desc">ğŸš€ç‚¹å‡»æŸ¥çœ‹Promise A+ çš„å®˜æ–¹è§„èŒƒ</p></div></a></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Promise A+ è§„èŒƒ
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> ğŸš€ç‚¹å‡»æŸ¥çœ‹Promise A+ çš„å®˜æ–¹è§„èŒƒ
  <span class="token key atrule">link</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//promisesaplus.com/
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">'#DFEEE7'</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">'#2A3344'</span>
</code></pre></div></div><p>flow æ˜é‡‘ <strong>ITè€ç­é•¿</strong>å¤§ä½¬çš„æ–‡ç« å­¦ç€æ‰‹å†™ä¸€ç‰ˆï¼Œ<strong>å¤§ä½¬è¯´é“</strong>ï¼šå¾ˆå¤šæ‰‹å†™ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨ setTimeout å»åšå¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯ setTimeout å±äºå®ä»»åŠ¡ï¼Œè¿™ä¸ Promise æ˜¯ä¸ªå¾®ä»»åŠ¡ç›¸çŸ›ç›¾ï¼Œæ‰€ä»¥æ‰“ç®—é€‰æ‹©ä¸€ç§åˆ›å»ºå¾®ä»»åŠ¡çš„æ–¹å¼å»å®ç°æˆ‘ä»¬çš„æ‰‹å†™ä»£ç ã€‚<br>
è¿™é‡Œæˆ‘ä»¬æœ‰å‡ ç§é€‰æ‹©ï¼Œä¸€ç§å°±æ˜¯ Promise A+ è§„èŒƒä¸­ä¹Ÿæåˆ°çš„ï¼Œprocess.nextTickï¼ˆ Node ç«¯ ï¼‰ ä¸MutationObserverï¼ˆ æµè§ˆå™¨ç«¯ ï¼‰ï¼Œè€ƒè™‘åˆ°åˆ©ç”¨è¿™ä¸¤ç§æ–¹å¼éœ€è¦åšç¯å¢ƒåˆ¤æ–­ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬å°±æ¨èå¦å¤–ä¸€ç§åˆ›å»ºå¾®ä»»åŠ¡çš„æ–¹å¼ queueMicrotask</p> <div class="language- extra-class"><pre><code>åŸºæœ¬åŸç†ï¼š
1. Promise æ˜¯ä¸€ä¸ªç±»ï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªç±»çš„æ—¶å€™ä¼šä¼ å…¥ä¸€ä¸ªæ‰§è¡Œå™¨ï¼Œè¿™ä¸ªæ‰§è¡Œå™¨ä¼šç«‹å³æ‰§è¡Œ
2. Promise ä¼šæœ‰ä¸‰ç§çŠ¶æ€
    Pending ç­‰å¾…
    Fulfilled å®Œæˆ
    Rejected å¤±è´¥
3. çŠ¶æ€åªèƒ½ç”± Pending --&gt; Fulfilled æˆ–è€… Pending --&gt; Rejectedï¼Œä¸”ä¸€ä½†å‘ç”Ÿæ”¹å˜ä¾¿ä¸å¯äºŒæ¬¡ä¿®æ”¹ï¼›
4. Promise ä¸­ä½¿ç”¨ resolve å’Œ reject ä¸¤ä¸ªå‡½æ•°æ¥æ›´æ”¹çŠ¶æ€ï¼›
5. then æ–¹æ³•å†…éƒ¨åšä½†äº‹æƒ…å°±æ˜¯çŠ¶æ€åˆ¤æ–­
    å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸï¼Œè°ƒç”¨æˆåŠŸå›è°ƒå‡½æ•°
    å¦‚æœçŠ¶æ€æ˜¯å¤±è´¥ï¼Œè°ƒç”¨å¤±è´¥å›è°ƒå‡½æ•°
</code></pre></div><h3 id="ä¸€ã€æ ¸å¿ƒç®€å•å®ç°"><a href="#ä¸€ã€æ ¸å¿ƒç®€å•å®ç°" class="header-anchor">#</a> ä¸€ã€æ ¸å¿ƒç®€å•å®ç°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>

    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>

    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
            <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><p>ä¸Šé¢ä»£ç å¯ä»¥å®ç°ç®€å•çš„æ–°å»ºpromiseäº†å¯ä»¥ç”¨å¦‚ä¸‹ä»£ç æµ‹è¯•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
   <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reject'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼šresolve success</span>
</code></pre></div><h3 id="äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†"><a href="#äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†" class="header-anchor">#</a> äºŒã€æ·»åŠ å¼‚æ­¥å¤„ç†</h3> <p>ä½†æ˜¯å¦‚æœå¤šæµ‹è¯•ä¸‹å°±å‘ç°è§£å†³ä¸äº†å¼‚æ­¥é—®é¢˜ï¼Œæ‰€ä»¥ç»§ç»­åŠ </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// å¼‚æ­¥æ–°å¢</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token keyword">null</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onFulfilledCallback</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onRejectedCallback</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
            <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback <span class="token operator">=</span> onFulfilled
            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback <span class="token operator">=</span> onFulfilled
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°"><a href="#ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°" class="header-anchor">#</a> ä¸‰ã€thenæ–¹æ³•å¤šæ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªå¤„ç†å‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
            <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨-äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«promiseæ˜¯å¦è¿”å›è‡ªå·±-å…­ã€é”™è¯¯æ•è·"><a href="#å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨-äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«promiseæ˜¯å¦è¿”å›è‡ªå·±-å…­ã€é”™è¯¯æ•è·" class="header-anchor">#</a> å››ã€thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨ &amp;&amp; äº”ã€thené“¾å¼è°ƒç”¨è¯†åˆ«Promiseæ˜¯å¦è¿”å›è‡ªå·± &amp;&amp; å…­ã€é”™è¯¯æ•è·</h3> <div class="language- extra-class"><pre><code>then æ–¹æ³•è¦é“¾å¼è°ƒç”¨é‚£ä¹ˆå°±éœ€è¦è¿”å›ä¸€ä¸ª Promise å¯¹è±¡
then æ–¹æ³•é‡Œé¢ return ä¸€ä¸ªè¿”å›å€¼ä½œä¸ºä¸‹ä¸€ä¸ª then æ–¹æ³•çš„å‚æ•°ï¼Œå¦‚æœæ˜¯ return ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ¤æ–­å®ƒçš„çŠ¶æ€
-------------------------------------------------------------------------------
å¦‚æœ then æ–¹æ³•è¿”å›çš„æ˜¯è‡ªå·±çš„ Promise å¯¹è±¡ï¼Œåˆ™ä¼šå‘ç”Ÿå¾ªç¯è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ç¨‹åºä¼šæŠ¥é”™
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token comment">// ===æ–°å¢===</span>
    <span class="token comment">// é“¾å¼è°ƒç”¨å°±å¾—è¿”å›promise åˆ¤æ–­çŠ¶æ€è¿›è¡Œå¤„ç†</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// === æ–°å¢ ===</span>
        <span class="token comment">// å…ˆåˆ›å»ºpromise</span>
        <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
                <span class="token comment">// ä¿å­˜è¿”å›çš„å¤„ç†å€¼</span>

                <span class="token comment">// äº”ã€éœ€è¦åˆ›å»ºå¾®ä»»åŠ¡ç­‰å¾…promise2åˆ›å»ºå®Œæ¯•</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// ï¼ï¼è¦å°†promise2 returnå‡ºæ¥</span>
        <span class="token keyword">return</span> promise2
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// === æ–°å¢ ===</span>
<span class="token comment">// åˆ›å»ºå‡½æ•°å¤„ç†promise</span>
<span class="token keyword">function</span> <span class="token function">resolvePromise</span> <span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ¤æ–­æ˜¯å¦promise</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span>
        <span class="token comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span>
        <span class="token comment">// ç®€åŒ–ä¹‹å</span>
        x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ™®é€šå€¼</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†-å¯¹rejected-å’Œpendingæ”¹é€ "><a href="#ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†-å¯¹rejected-å’Œpendingæ”¹é€ " class="header-anchor">#</a> ä¸ƒã€è€ƒè™‘fufilledçŠ¶æ€ä¸‹çš„å¤„ç†ï¼Œå¯¹rejected å’Œpendingæ”¹é€ </h3> <div class="language- extra-class"><pre><code>å¢åŠ å¼‚æ­¥çŠ¶æ€ä¸‹çš„é“¾å¼è°ƒç”¨
å¢åŠ å›è°ƒå‡½æ•°æ‰§è¡Œç»“æœçš„åˆ¤æ–­
å¢åŠ è¯†åˆ« Promise æ˜¯å¦è¿”å›è‡ªå·±
å¢åŠ é”™è¯¯æ•è·
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token comment">// ===æ–°å¢===</span>
    <span class="token comment">// é“¾å¼è°ƒç”¨å°±å¾—è¿”å›promise åˆ¤æ–­çŠ¶æ€è¿›è¡Œå¤„ç†</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// === æ–°å¢ ===</span>
        <span class="token comment">// å…ˆåˆ›å»ºpromise</span>
        <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
                <span class="token comment">// ä¿å­˜è¿”å›çš„å¤„ç†å€¼</span>

                <span class="token comment">// äº”ã€éœ€è¦åˆ›å»ºå¾®ä»»åŠ¡ç­‰å¾…promise2åˆ›å»ºå®Œæ¯•</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åŒä¸Šé¢ å¢åŠ å¾®ä»»åŠ¡</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
                <span class="token comment">// === æ–°å¢ ===</span>
                <span class="token comment">// ===éœ€è¦pushè¿›å»çš„åº”è¯¥æ˜¯å¾®ä»»åŠ¡===</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// ï¼ï¼è¦å°†promise2 returnå‡ºæ¥</span>
        <span class="token keyword">return</span> promise2
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆ›å»ºå‡½æ•°å¤„ç†promise</span>
<span class="token keyword">function</span> <span class="token function">resolvePromise</span> <span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ¤æ–­æ˜¯å¦promise</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span>
        <span class="token comment">// x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span>
        <span class="token comment">// ç®€åŒ–ä¹‹å</span>
        x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ™®é€šå€¼</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h3 id="å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰-ä¹ã€resolve-å’Œ-rejectçš„é™æ€è°ƒç”¨"><a href="#å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰-ä¹ã€resolve-å’Œ-rejectçš„é™æ€è°ƒç”¨" class="header-anchor">#</a> å…«ã€thenä¸­çš„å‚æ•°å˜ä¸ºå¯é€‰ &amp;&amp; ä¹ã€resolve å’Œ rejectçš„é™æ€è°ƒç”¨</h3> <p>åŸç”Ÿpromise then ä¸ä¼ é€’å›è°ƒå‡½æ•°ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œexecutoræ˜¯æ‰§è¡Œå™¨</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æœ€å¼€å§‹çš„çŠ¶æ€æ˜¯PENDING</span>
    status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token comment">// æˆåŠŸåçš„å€¼ åˆå§‹ä¸ºç©º</span>
    value <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¤±è´¥åçš„åŸå›  åˆå§‹ä¸ºç©º</span>
    reason <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// thenä¿®æ”¹ éœ€è¦ä¸ºæ•°ç»„</span>
    <span class="token comment">// ç¼“å­˜æˆåŠŸå›è°ƒå‡½æ•°</span>
    onFulfilledCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// ç¼“å­˜å¤±è´¥å›è°ƒå‡½æ•°</span>
    onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token comment">// resolveå’Œrejectä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</span>
    <span class="token comment">// å¦‚æœç›´æ¥è°ƒç”¨çš„è¯ï¼Œæ™®é€šå‡½æ•°thisæŒ‡å‘çš„æ˜¯windowæˆ–è€…undefined</span>
    <span class="token comment">// ç”¨ç®­å¤´å‡½æ•°å°±å¯ä»¥è®©thisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡</span>
    <span class="token comment">// æ›´æ”¹æˆåŠŸåçš„çŠ¶æ€</span>
    <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸåçŠ¶æ€ä¼šè¾¹ä¸ºfulfilled</span>
        <span class="token comment">// !åªæœ‰çŠ¶æ€ä¸ºpendingæ‰èƒ½æ›´æ”¹çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
            <span class="token comment">// æˆåŠŸåè¿”å›å€¼</span>
            <span class="token comment">// ï¼ä¿å­˜æˆåŠŸçš„è¿”å›å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ›´æ”¹å¤±è´¥åçš„çŠ¶æ€</span>
    <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°å¤±è´¥åçš„çŠ¶æ€</span>
        <span class="token comment">// åªèƒ½æ”¹å˜pendingçš„çŠ¶æ€</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            <span class="token comment">// è¿”å›å¤±è´¥åŸå› </span>
            <span class="token comment">// !ä¿å­˜å¤±è´¥çš„åŸå› </span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
            <span class="token comment">// è°ƒç”¨å›è°ƒå‡½æ•°</span>
            <span class="token comment">// ä¿®æ”¹è°ƒç”¨</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¤„ç†then </span>
    <span class="token comment">// ï¼THENæ˜¯ä¸ªå‡½æ•°ï¼Œä¸”ä¼šå¤„ç†onFulfilledå’ŒonRejected</span>
    <span class="token comment">// ===æ–°å¢===</span>
    <span class="token comment">// é“¾å¼è°ƒç”¨å°±å¾—è¿”å›promise åˆ¤æ–­çŠ¶æ€è¿›è¡Œå¤„ç†</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// !éœ€è¦åˆ¤æ–­çŠ¶æ€</span>
        <span class="token comment">// å…« === æ–°å¢ ===</span>
        onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
        onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> reason<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// å…ˆåˆ›å»ºpromise</span>
        <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€æ˜¯æˆåŠŸåˆ™è°ƒç”¨onFulfilled</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è°ƒç”¨å‡½æ•°</span>
                <span class="token comment">// ä¿å­˜è¿”å›çš„å¤„ç†å€¼</span>

                <span class="token comment">// äº”ã€éœ€è¦åˆ›å»ºå¾®ä»»åŠ¡ç­‰å¾…promise2åˆ›å»ºå®Œæ¯•</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åŒä¸Šé¢ å¢åŠ å¾®ä»»åŠ¡</span>
                <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
                        <span class="token comment">// ç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†å€¼ï¼Œéœ€è¦åˆ¤æ–­æ˜¯promiseè¿˜æ˜¯æ™®é€šå‡½æ•°</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//! è°ƒç”¨çš„ä¼ å…¥çš„reject è€Œä¸æ˜¯this.reject</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ·»åŠ pendingæ—¶å€™çš„å¤„ç†</span>
                <span class="token comment">// === æ–°å¢ ===</span>
                <span class="token comment">// ===éœ€è¦pushè¿›å»çš„åº”è¯¥æ˜¯å¾®ä»»åŠ¡===</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è·å–æˆåŠŸå›è°ƒå‡½æ•°çš„æ‰§è¡Œç»“æœ</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// è°ƒç”¨å¤±è´¥å›è°ƒï¼Œå¹¶ä¸”æŠŠåŸå› è¿”å›</span>
                            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// ä¼ å…¥ resolvePromise é›†ä¸­å¤„ç†</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// ï¼ï¼è¦å°†promise2 returnå‡ºæ¥</span>
        <span class="token keyword">return</span> promise2
    <span class="token punctuation">}</span>
    <span class="token comment">// ä¹ã€å¢åŠ é™æ€æ–¹æ³•</span>
    <span class="token keyword">static</span> <span class="token function">resolve</span> <span class="token punctuation">(</span><span class="token parameter">parameter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>parameter <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> parameter
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token parameter">resovle</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token function">reject</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆ›å»ºå‡½æ•°å¤„ç†promise</span>
<span class="token keyword">function</span> <span class="token function">resolvePromise</span> <span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// // åˆ¤æ–­æ˜¯å¦promise</span>
    <span class="token comment">// if(x instanceof MyPromise) {</span>
    <span class="token comment">//     // æ‰§è¡Œ xï¼Œè°ƒç”¨ then æ–¹æ³•ï¼Œç›®çš„æ˜¯å°†å…¶çŠ¶æ€å˜ä¸º fulfilled æˆ–è€… rejected</span>
    <span class="token comment">//     // x.then(value =&gt; resolve(value), reason =&gt; reject(reason))</span>
    <span class="token comment">//     // ç®€åŒ–ä¹‹å</span>
    <span class="token comment">//     x.then(resolve, reject)</span>

    <span class="token comment">// ========è¿™æ³¢å±…ç„¶è¦æ”¹æˆ ===========</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// x ä¸º null ç›´æ¥è¿”å›ï¼Œèµ°åé¢çš„é€»è¾‘ä¼šæŠ¥é”™</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> then<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŠŠ x.then èµ‹å€¼ç»™ then </span>
            then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœå– x.then çš„å€¼æ—¶æŠ›å‡ºé”™è¯¯ error ï¼Œåˆ™ä»¥ error ä¸ºæ®å› æ‹’ç» promise</span>
            <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœ then æ˜¯å‡½æ•°</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> called <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
                x<span class="token punctuation">,</span> <span class="token comment">// this æŒ‡å‘ x</span>
                <span class="token comment">// å¦‚æœ resolvePromise ä»¥å€¼ y ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™è¿è¡Œ [[Resolve]](promise, y)</span>
                <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// å¦‚æœ resolvePromise å’Œ rejectPromise å‡è¢«è°ƒç”¨ï¼Œ</span>
                    <span class="token comment">// æˆ–è€…è¢«åŒä¸€å‚æ•°è°ƒç”¨äº†å¤šæ¬¡ï¼Œåˆ™ä¼˜å…ˆé‡‡ç”¨é¦–æ¬¡è°ƒç”¨å¹¶å¿½ç•¥å‰©ä¸‹çš„è°ƒç”¨</span>
                    <span class="token comment">// å®ç°è¿™æ¡éœ€è¦å‰é¢åŠ ä¸€ä¸ªå˜é‡ called</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                    called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// å¦‚æœ rejectPromise ä»¥æ®å›  r ä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œåˆ™ä»¥æ®å›  r æ‹’ç» promise</span>
                <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                    called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¦‚æœè°ƒç”¨ then æ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ errorï¼š</span>
                <span class="token comment">// å¦‚æœ resolvePromise æˆ– rejectPromise å·²ç»è¢«è°ƒç”¨ï¼Œç›´æ¥è¿”å›</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token comment">// å¦åˆ™ä»¥ error ä¸ºæ®å› æ‹’ç» promise</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœ then ä¸æ˜¯å‡½æ•°ï¼Œä»¥ x ä¸ºå‚æ•°æ‰§è¡Œ promise</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ™®é€šå€¼</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPromise
</code></pre></div><h2 id="promiseæ–¹æ³•"><a href="#promiseæ–¹æ³•" class="header-anchor">#</a> promiseæ–¹æ³•</h2> <blockquote><p>å†ç»åƒè¾›ä¸‡è‹¦ è¿˜æœ‰åƒè¾›ä¸‡è‹¦
å­¦ä¼šäº†æ‰‹å†™promiseå‡½æ•°ï¼Œè¿˜éœ€è¦å†™promise.all(),promise.race()ç­‰ç­‰,åŠ æ²¹å§å°‘å¹´</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">5/15/2022, 2:52:03 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/vuepressBolg/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/vuepressBolg/pages/e8a445/"><div>
            ä¸‰æ•°ä¹‹å’Œ
            <!----></div></a> <span class="date">05-15</span></dt></dl><dl><dd>02</dd> <dt><a href="/vuepressBolg/pages/6408f9/"><div>
            æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾â€”æ•°ç»„ä»‹ç»
            <!----></div></a> <span class="date">05-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/vuepressBolg/pages/429bea/"><div>
            Zå­—å½¢å˜æ¢
            <!----></div></a> <span class="date">04-20</span></dt></dl> <dl><dd></dd> <dt><a href="/vuepressBolg/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2021-2022
    <span></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">Ã—</span> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/vuepressBolg/assets/js/app.92d159cb.js" defer></script><script src="/vuepressBolg/assets/js/2.c937a76a.js" defer></script><script src="/vuepressBolg/assets/js/3.ed4544f5.js" defer></script><script src="/vuepressBolg/assets/js/23.deca2de3.js" defer></script>
  </body>
</html>
